# 1. 数据存储文件说明

## 1.1 网格点划分说明

将东经[70°,140°], 北纬[10°, 60°] 之间的区域按照0.25°*0.25°的网格大小进行了网格化处理，经度为70°至140°，南北10°至60°. 

对应的经纬度信息在Lon和Lat这两个文件中保存，文件中的数据点以Latitude为行，Longtitude 为列进行划分。在Lon和Lat中，存储的是每个点对应的Lon/Lat等信息，也是按照行列进行划分。

降雨量、温度等数据点对应的经纬度信息在对应的（Lon, Lat)中对应的行列位置查询得到，对应的时间信息丛文件名中得到。

## 1.2 地面累计降雨量数据

1. **文件名**格式为： 文件名为yyyymmdd_20-8/8-20.txt的文件，其中前8个字符为日期yyyymmdd格式，其中：
   - 1.1  8-20代表当天早8到晚20时的12小时累计降水，20-8代表前一天晚20到当天早8时的12小时累计降水，该时间为北京时间。
   - 1.2  部分数据有插值得到，降雨量数据如果小于0.0 可以认为是0.
2. **文件内容**，每个存储数据都是一个累计降雨量，其对应的经纬度信息在对应的（Lon, Lat)中对应的行列位置查询得到，对应的时间信息丛文件名中得到。内容为NaN表示数据缺失或者被故意掩盖掉了。下面是文件中的前几行，供参考。

```sample
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-7.8083,-7.1611,0,0,-3.5775,-1.1356,2.1405,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15.997,26.672,29.883,37.185,48.334,49.81,67.105,0,-4.6533,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-3.4289,-3.2022,-3.9194,-3.6505,-3.947,-4.1754,-2.7613,1.0346,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,19.913,36.143,63.586,110.35,158.2,70.574,4.4164,12.373,36.099,35.658,29.264,24.666,18.501,6.4687,7.1702,-5.9906,-20.756,-17.249,0,0,17.294,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4.4555,4.1254,1.1959,0.028299,-2.9714,-5.5945,-5.5092,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.82953,2.2661,8.1005,15.799,27.381,59.896,112.17,57.591,-2.9444,7.0002,27.084,30.9,19.135,8.9205,8.4016,3.2092,0.4179,-4.8512,-14.519,-15.397,-9.325,0.67701,11.863,18.591,22.296,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-4.4963,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
```


## 1.3 hpa类数据（不同层高的瞬时大气温度）
1. **文件名**格式为： 文件名为yyyymmdd_00/12_hpa{number}_{type}.txt的文件，其中前8个字符为日期yyyymmdd格式，其中：
   - 1.1  00/12代表当天00或者晚12时的瞬时时间，时间为标准时间，转换为北京时间，需要+8小时。
   - 1.2 hpa{number}，中的number 表示探空高度，包括{100, 150, 200, 250, 300,400, 500, 700, 850, 925, 1000} 共计11个高度。
   - 1.3 {type} 为数据类型，包括{DPT, GPH, TEM, U, V}，这里：DPT表示露点温度， GPH表示位势高度， TEM表示气温，U表示风在U方向分量（东西向）， V表示风在V方向分量（南北向）
2. **文件内容**，每个存储数据都是一个，其对应的经纬度信息在对应的（Lon, Lat)中对应的行列位置查询得到，对应的时间信息丛文件名中得到。存储格式与降雨量类似。

## 1.4 文件存储方式

1. pre_Data/ 下面保存的是降雨量数据文件，对应 1.2 里面的内容；
2. souding_data/ 下面保存的是hpa类型数据，对应 1.3 里面的内容；
3. Lon/Lat 两个文件内保存的文件是网格点对应的经、纬度数据。内容如下：

```Lat
10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10
10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25,10.25
```

```Lon
70,70.25,70.5,70.75,71,71.25,71.5,71.75,72,72.25,72.5,72.75,73,73.25,73.5,73.75,74,74.25,74.5,74.75,75,75.25,75.5,75.75,76,76.25,76.5,76.75,77,77.25,77.5,77.75,78,78.25,78.5,78.75,79,79.25,79.5,79.75,80,80.25,80.5,80.75,81,81.25,81.5,81.75,82,82.25,82.5,82.75,83,83.25,83.5,83.75,84,84.25,84.5,84.75,85,85.25,85.5,85.75,86,86.25,86.5,86.75,87,87.25,87.5,87.75,88,88.25,88.5,88.75,89,89.25,89.5,89.75,90,90.25,90.5,90.75,91,91.25,91.5,91.75,92,92.25,92.5,92.75,93,93.25,93.5,93.75,94,94.25,94.5,94.75,95,95.25,95.5,95.75,96,96.25,96.5,96.75,97,97.25,97.5,97.75,98,98.25,98.5,98.75,99,99.25,99.5,99.75,100,100.25,100.5,100.75,101,101.25,101.5,101.75,102,102.25,102.5,102.75,103,103.25,103.5,103.75,104,104.25,104.5,104.75,105,105.25,105.5,105.75,106,106.25,106.5,106.75,107,107.25,107.5,107.75,108,108.25,108.5,108.75,109,109.25,109.5,109.75,110,110.25,110.5,110.75,111,111.25,111.5,111.75,112,112.25,112.5,112.75,113,113.25,113.5,113.75,114,114.25,114.5,114.75,115,115.25,115.5,115.75,116,116.25,116.5,116.75,117,117.25,117.5,117.75,118,118.25,118.5,118.75,119,119.25,119.5,119.75,120,120.25,120.5,120.75,121,121.25,121.5,121.75,122,122.25,122.5,122.75,123,123.25,123.5,123.75,124,124.25,124.5,124.75,125,125.25,125.5,125.75,126,126.25,126.5,126.75,127,127.25,127.5,127.75,128,128.25,128.5,128.75,129,129.25,129.5,129.75,130,130.25,130.5,130.75,131,131.25,131.5,131.75,132,132.25,132.5,132.75,133,133.25,133.5,133.75,134,134.25,134.5,134.75,135,135.25,135.5,135.75,136,136.25,136.5,136.75,137,137.25,137.5,137.75,138,138.25,138.5,138.75,139,139.25,139.5,139.75,140
```

# 2 使用xarray 方式进行保存

## 2.1 xarray 定义的schema 

xarray 具有数据压缩效率高的特点，比SQLite存储更加节省空间，存储的schema类似如下定义

```python
import numpy as np
import pandas as pd
import xarray as xr

# 时间序列
times = pd.date_range(...) #根据文件信息进行读取
lats = np.arange(...) # 实际从网格数据中读取
lons = np.arange(...) #实际从网格数据中读取
levels = [ "850hPa", "700hPa", ...]

# 创建空的 DataArray
rain = xr.DataArray(
    np.random.rand(len(times), len(lats), len(lons)), 
    dims=["time", "lat", "lon"],
    coords={"time": times, "lat": lats, "lon": lons},
    name="precipitation"
)

temp = xr.DataArray(
    np.random.rand(len(times), len(levels), len(lats), len(lons)),
    dims=["time", "level", "lat", "lon"],
    coords={"time": times, "level": levels, "lat": lats, "lon": lons},
    name="TMP"
)


# 合并成 Dataset
ds = xr.Dataset({"precipitation": rain, "TMP": temp, ...})
```

## 2.2 代码实现

实现从 #1 中定义的文件内容中加载到xarray，然后再保存到磁盘上的方法。